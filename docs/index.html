<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="The purpose of this package is to generate trees and validate unverified code. Trees are made by parsing a statement into a verification tree data structure. This will make it easy to port the statement into another language. Safe statement evaluations are done by executing the verification trees.">
<title>Evaluation of Unverified Code • evalR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Evaluation of Unverified Code">
<meta property="og:description" content="The purpose of this package is to generate trees and validate unverified code. Trees are made by parsing a statement into a verification tree data structure. This will make it easy to port the statement into another language. Safe statement evaluations are done by executing the verification trees.">
<meta property="og:image" content="https://numerious.github.io/evalR/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">evalR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/Overview.html">Overview</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="evalr-">evalR <a class="anchor" aria-label="anchor" href="#evalr-"></a>
</h1>
</div>
<!-- badges: start -->

<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The purpose of this package is to generate verification trees and evaluations of user supplied statements. Trees are made by parsing a statement into a data structure composed of lists. Safe statement evaluations are done by executing the verification trees.</p>
<div class="section level3">
<h3 id="verification-trees">Verification Trees<a class="anchor" aria-label="anchor" href="#verification-trees"></a>
</h3>
<p>Any statement can be represented by a tree data structure. Here is a quote from Wikipedia to explain the concept:</p>
<blockquote>
<p>In computer science, a tree is a widely used abstract data type that represents a hierarchical tree structure with a set of connected nodes. Each node in the tree can be connected to many children (depending on the type of tree), but must be connected to exactly one parent, except for the root node, which has no parent. These constraints mean there are no cycles or “loops” (no node can be its own ancestor), and also that each child can be treated like the root node of its own subtree, making recursion a useful technique for tree traversal. In contrast to linear data structures, many trees cannot be represented by relationships between neighboring nodes in a single straight line.</p>
<p>— Wikipedia.org Tree (data structure)</p>
</blockquote>
<p>By default the package will know how to parse a R statement into a tree. In theory, you could supply your own tokens and use the package to parse any language that follows similar grammar.</p>
<p>These verification trees have been used to port R statements into other languages. For example, one use case is to write out formulas in excel that replicate the calculations done in R.</p>
</div>
<div class="section level3">
<h3 id="safe-evaluation">Safe Evaluation<a class="anchor" aria-label="anchor" href="#safe-evaluation"></a>
</h3>
<p>Writing code that executes unverified code can be both powerful and dangerous. A common approach to doing this is with the following pattern:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/parse.html" class="external-link">parse</a></span><span class="op">(</span>text<span class="op">=</span><span class="st">"unverified_code"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The power comes from the flexibility this pattern gives us. It usually comes with a significant performance cost, but CPU time is cheaper than our developers.</p>
<p>The danger comes from unknown unknowns. Your own input on your personal computer may not pose much of a risk. The same does not hold for input from nefarious/clever users on a server.</p>
<p>Execution of a verification tree generated on unverified code is a different story. The risk is limited to what is deemed acceptable based on the supplied tokens. It comes with a greater performance cost, but removes the danger from unverified code.</p>
</div>
</div>
<div class="section level2">
<h2 id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a>
</h2>
<p>The focus of this package is limited to just creating and evaluating trees. The next sections cover the main functions.</p>
<div class="section level3">
<h3 id="create_tree">create_tree<a class="anchor" aria-label="anchor" href="#create_tree"></a>
</h3>
<p>The <code>create_tree</code> function takes a string and generates a tree. For example, we can parse the simple expression <code>2+3</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">evalR</span><span class="fu">::</span><span class="fu"><a href="reference/create_tree.html">create_tree</a></span><span class="op">(</span><span class="st">"2+3"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ pval: list()</span></span>
<span><span class="co">#&gt;  $ eval:List of 3</span></span>
<span><span class="co">#&gt;   ..$ : chr "+"</span></span>
<span><span class="co">#&gt;   ..$ :List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ : chr "atomic"</span></span>
<span><span class="co">#&gt;   .. ..$ : chr "2"</span></span>
<span><span class="co">#&gt;   ..$ :List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ : chr "atomic"</span></span>
<span><span class="co">#&gt;   .. ..$ : chr "3"</span></span></code></pre></div>
<p>We can see the structure is a list of lists.</p>
<div class="section level4">
<h4 id="under-the-hood">Under the hood<a class="anchor" aria-label="anchor" href="#under-the-hood"></a>
</h4>
<p>You don’t need to understand the structure of the tree to use it. Just like you can drive a car without knowing how an engine works. This section will help reveal how the trees are formed.</p>
<p>First lets confirm that we can replicate the tree structure:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  pval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  eval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"+"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"atomic"</span>, <span class="st">"2"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"atomic"</span>, <span class="st">"3"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html" class="external-link">expect_equal</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">tree</span><span class="op">)</span></span></code></pre></div>
<p>This test passes with zero error.</p>
<p>A full tree is made up of two main branches:</p>
<ul>
<li>
<code>pval</code> - stands for parenthesis values</li>
<li>
<code>eval</code> - stands for verification values</li>
</ul>
<div class="section level5">
<h5 id="pval">pval<a class="anchor" aria-label="anchor" href="#pval"></a>
</h5>
<p>The first thing the function does is find all parenthesis blocks and treats them as sub statements. Each of these sub statements becomes an element of the <code>pval</code> element. The <code>eval</code> tree will have references to these <code>pval</code> entries.</p>
<p>For example, lets tweak the <code>2+3</code> to <code>(2)+(3)</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">evalR</span><span class="fu">::</span><span class="fu"><a href="reference/create_tree.html">create_tree</a></span><span class="op">(</span><span class="st">"(2)+(3)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ pval:List of 2</span></span>
<span><span class="co">#&gt;   ..$ \0:List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ pval: list()</span></span>
<span><span class="co">#&gt;   .. ..$ eval:List of 2</span></span>
<span><span class="co">#&gt;   .. .. ..$ : chr "atomic"</span></span>
<span><span class="co">#&gt;   .. .. ..$ : chr "2"</span></span>
<span><span class="co">#&gt;   ..$ \1:List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ pval: list()</span></span>
<span><span class="co">#&gt;   .. ..$ eval:List of 2</span></span>
<span><span class="co">#&gt;   .. .. ..$ : chr "atomic"</span></span>
<span><span class="co">#&gt;   .. .. ..$ : chr "3"</span></span>
<span><span class="co">#&gt;  $ eval:List of 3</span></span>
<span><span class="co">#&gt;   ..$ : chr "+"</span></span>
<span><span class="co">#&gt;   ..$ :List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ : chr "atomic"</span></span>
<span><span class="co">#&gt;   .. ..$ : chr "\\0"</span></span>
<span><span class="co">#&gt;   ..$ :List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ : chr "atomic"</span></span>
<span><span class="co">#&gt;   .. ..$ : chr "\\1"</span></span></code></pre></div>
<p>To replicate the structure:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pval_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"\\0"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    pval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    eval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"atomic"</span>, <span class="st">"2"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="st">"\\1"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    pval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    eval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"atomic"</span>, <span class="st">"3"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  pval <span class="op">=</span> <span class="va">pval_list</span>,</span>
<span>  eval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"+"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"atomic"</span>, <span class="st">"\\0"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"atomic"</span>, <span class="st">"\\1"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html" class="external-link">expect_equal</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">tree</span><span class="op">)</span></span></code></pre></div>
<p>This test passes with zero error.</p>
<p>Now the <code>pval</code> list is not empty. We have an entry for <code>(2)</code> and <code>(3)</code>. Each entry in <code>pval</code> is a new tree unto itself and contains <code>pval</code> and <code>eval</code> branches.</p>
</div>
<div class="section level5">
<h5 id="eval">eval<a class="anchor" aria-label="anchor" href="#eval"></a>
</h5>
<p>The <code>eval</code> branch splits the statement by operators into “atomic” elements.</p>
<p>For example, if we just parse <code>2</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">evalR</span><span class="fu">::</span><span class="fu"><a href="reference/create_tree.html">create_tree</a></span><span class="op">(</span><span class="st">"2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ pval: list()</span></span>
<span><span class="co">#&gt;  $ eval:List of 2</span></span>
<span><span class="co">#&gt;   ..$ : chr "atomic"</span></span>
<span><span class="co">#&gt;   ..$ : chr "2"</span></span></code></pre></div>
<p>The <code>eval</code> is one level deep and the first element is the string <code>atomic</code>. This signifies that this is an end node of the tree.</p>
<p>Lets expand this just a little bit:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">evalR</span><span class="fu">::</span><span class="fu"><a href="reference/create_tree.html">create_tree</a></span><span class="op">(</span><span class="st">"-2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ pval: list()</span></span>
<span><span class="co">#&gt;  $ eval:List of 2</span></span>
<span><span class="co">#&gt;   ..$ : chr "-"</span></span>
<span><span class="co">#&gt;   ..$ :List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ : chr "atomic"</span></span>
<span><span class="co">#&gt;   .. ..$ : chr "2"</span></span></code></pre></div>
<p>Now <code>eval</code> is two levels deep. The first element states the operator <code>-</code> and the second element is another branch that looks exactly like the <code>eval</code> branch in the previous example.</p>
<p>If a parenthesis block is found, then the atomic element will be a reference to the which <code>pval</code> element:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">evalR</span><span class="fu">::</span><span class="fu"><a href="reference/create_tree.html">create_tree</a></span><span class="op">(</span><span class="st">"-(2)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ pval:List of 1</span></span>
<span><span class="co">#&gt;   ..$ \0:List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ pval: list()</span></span>
<span><span class="co">#&gt;   .. ..$ eval:List of 2</span></span>
<span><span class="co">#&gt;   .. .. ..$ : chr "atomic"</span></span>
<span><span class="co">#&gt;   .. .. ..$ : chr "2"</span></span>
<span><span class="co">#&gt;  $ eval:List of 2</span></span>
<span><span class="co">#&gt;   ..$ : chr "-"</span></span>
<span><span class="co">#&gt;   ..$ :List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ : chr "atomic"</span></span>
<span><span class="co">#&gt;   .. ..$ : chr "\\0"</span></span></code></pre></div>
<p>In this example, the <code>eval</code> second level atomic element is <code>\0</code>. This is a reference to the <code>\0</code> named element of the <code>pval</code> branch.</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="eval_tree">eval_tree<a class="anchor" aria-label="anchor" href="#eval_tree"></a>
</h3>
<p>Given a tree, we can execute it with the function <code>eval_tree</code>. Here is a basic example:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">evalR</span><span class="fu">::</span><span class="fu"><a href="reference/create_tree.html">create_tree</a></span><span class="op">(</span><span class="st">"2+3"</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">evalR</span><span class="fu">::</span><span class="fu"><a href="reference/eval_tree.html">eval_tree</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 5</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="eval_text">eval_text<a class="anchor" aria-label="anchor" href="#eval_text"></a>
</h3>
<p>There is a convenience function that contains the tree creation stage. The <code>eval_text</code> takes text as an input:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">evalR</span><span class="fu">::</span><span class="fu"><a href="reference/eval_text.html">eval_text</a></span><span class="op">(</span><span class="st">"2+3"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 5</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="shared-parameters">Shared Parameters<a class="anchor" aria-label="anchor" href="#shared-parameters"></a>
</h2>
<p>These three functions share the following parameters:</p>
<ul>
<li>singular_operators - tokens of length 1 that operate on a right hand value. For example, the <code>-</code> token is an operator to negate a vector. <code>NULL</code> value will be replaced with <code>c("-", "!")</code>.</li>
<li>binary_operators - tokens of any length that operate on a left and right hand values. For example, the <code>+</code> token is an operator that adds a left vector to a right vector. <code>NULL</code> value will be replaced with <code>c(",","|", "&amp;", "&lt;=", "&lt;", "&gt;=", "&gt;", "==", "!=", "+", "-", "*", "%/%", "/", "%%", "%in%", ":", "^")</code>. The order determines the precedence of the operators.</li>
<li>valid_functions - tokens of any length that are prefixed on a parenthesis block and specify a function to run on the provided parameters within the block. For example, the <code>log</code> token will evaluate the logarithm value of the first parameter. Note named parameters are not support. <code>NULL</code> value will be replaced with <code>c("log","c", "any","all", "abs","ifelse")</code>.</li>
</ul>
<p>For example, if you want to be able to use the function <code>rnorm</code>, then you need to provide that as a item in the <code>valid_functions</code> parameter:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">102</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">evalR</span><span class="fu">::</span><span class="fu"><a href="reference/eval_text.html">eval_text</a></span><span class="op">(</span><span class="st">"2+rnorm(1)"</span>, valid_functions<span class="op">=</span><span class="st">"rnorm"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2.180523</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="map-parameter">map Parameter<a class="anchor" aria-label="anchor" href="#map-parameter"></a>
</h2>
<p>The <code>eval_tree</code> and <code>eval_text</code> share the following parameter:</p>
<ul>
<li>map - a named list of data.frames/lists/matrices. Where the names are keys for referencing the values in the parameters.</li>
</ul>
<p>This parameter limits the scope of the execution environment (not in a strictly technical sense). In other words, they limit what values can be reference.</p>
<p>Here is a basic concert example:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"#"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, y <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">evalR</span><span class="fu">::</span><span class="fu"><a href="reference/eval_text.html">eval_text</a></span><span class="op">(</span><span class="st">"log(#x#)"</span>, map<span class="op">=</span><span class="va">map_obj</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.0000000 0.6931472 1.0986123 1.3862944 1.6094379</span></span></code></pre></div>
<p>Here is a more complex example:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"#"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, y <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>,<span class="st">"$"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>z <span class="op">=</span> <span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">evalR</span><span class="fu">::</span><span class="fu"><a href="reference/eval_text.html">eval_text</a></span><span class="op">(</span><span class="st">"#x# + $z$"</span>, map<span class="op">=</span><span class="va">map_obj</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0 0 0 0 0</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="microbenchmark">microbenchmark<a class="anchor" aria-label="anchor" href="#microbenchmark"></a>
</h2>
<p>To get a sense of the performance. Lets compare different ways we can run <code>log(1+2)</code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">text</span> <span class="op">&lt;-</span> <span class="st">"log(1+3)"</span></span>
<span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu">evalR</span><span class="fu">::</span><span class="fu"><a href="reference/create_tree.html">create_tree</a></span><span class="op">(</span><span class="va">text</span><span class="op">)</span></span>
<span><span class="fu">microbenchmark</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fl">2</span><span class="op">)</span><span class="op">}</span>,</span>
<span>  <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/parse.html" class="external-link">parse</a></span><span class="op">(</span>text<span class="op">=</span><span class="va">text</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>,</span>
<span>  <span class="op">{</span><span class="fu">evalR</span><span class="fu">::</span><span class="fu"><a href="reference/eval_tree.html">eval_tree</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span><span class="op">}</span>,</span>
<span>  <span class="op">{</span><span class="fu">evalR</span><span class="fu">::</span><span class="fu"><a href="reference/eval_text.html">eval_text</a></span><span class="op">(</span><span class="va">text</span><span class="op">)</span><span class="op">}</span>,</span>
<span>  <span class="op">{</span><span class="fu">evalR</span><span class="fu">::</span><span class="fu"><a href="reference/create_tree.html">create_tree</a></span><span class="op">(</span><span class="va">text</span><span class="op">)</span><span class="op">}</span>, n<span class="op">=</span><span class="fl">1000</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in microbenchmark::microbenchmark({: Could not measure a positive</span></span>
<span><span class="co">#&gt; execution time for 68 evaluations.</span></span>
<span><span class="co">#&gt; Unit: nanoseconds</span></span>
<span><span class="co">#&gt;                              expr    min     lq   mean median     uq     max</span></span>
<span><span class="co">#&gt;                {     log(1 + 2) }    100    100    274    200    350    1900</span></span>
<span><span class="co">#&gt;  {     eval(parse(text = text)) }   4700   6600   9578   8400  10000   36200</span></span>
<span><span class="co">#&gt;    {     evalR::eval_tree(tree) }  20400  22950  30774  25900  29950  126400</span></span>
<span><span class="co">#&gt;    {     evalR::eval_text(text) } 176300 192000 233953 217950 256600  391100</span></span>
<span><span class="co">#&gt;  {     evalR::create_tree(text) } 152800 167200 226799 197800 241100 1653000</span></span>
<span><span class="co">#&gt;                                 n      0      0      3      0      0     300</span></span>
<span><span class="co">#&gt;  neval</span></span>
<span><span class="co">#&gt;    100</span></span>
<span><span class="co">#&gt;    100</span></span>
<span><span class="co">#&gt;    100</span></span>
<span><span class="co">#&gt;    100</span></span>
<span><span class="co">#&gt;    100</span></span>
<span><span class="co">#&gt;    100</span></span></code></pre></div>
<p>The pure R evaluation is much faster than any of the other methods. This is no surprise.</p>
<p>The <code><a href="reference/eval_tree.html">evalR::eval_tree</a></code> block takes a couple times longer than the <code>eval(parse(text))</code> execution. This is a trade off considering the reduced risk. The <code>eval(parse(text))</code> execution is sometimes much slower when ran outside R markdown.</p>
<p>We also see that <code><a href="reference/eval_text.html">evalR::eval_text</a></code> takes much longer than <code><a href="reference/eval_tree.html">evalR::eval_tree</a></code>. The majority of the <code><a href="reference/eval_text.html">evalR::eval_text</a></code> time comes from the internal call to <code><a href="reference/create_tree.html">evalR::create_tree</a></code>. This is where the no free lunch principle comes into play. The cost of the reduced risk is spent in creating the tree.</p>
<p>If you’re lucky enough to have a set of user input that will be evaluated multiple times, then the design pattern of generating the tree once and using <code><a href="reference/eval_tree.html">evalR::eval_tree</a></code> will give similar performance to a straight <code>eval</code> call.</p>
</div>
<div class="section level2">
<h2 id="final-thoughts">Final Thoughts<a class="anchor" aria-label="anchor" href="#final-thoughts"></a>
</h2>
<p>This package should be viewed as a building block and not as an end unto itself. You can consider using it anytime you’re tempted to write an <code>eval(parse(text))</code> statement.</p>
</div>
<div class="section level2">
<h2 id="credit">Credit<a class="anchor" aria-label="anchor" href="#credit"></a>
</h2>
<p>Package logo was created using the <a href="https://game-icons.net" class="external-link">game-icons.net</a> website. Thank you for such a great product and for people willing to share their talents with others.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=evalR" class="external-link">View on CRAN</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing evalR</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Numerious Inc. <br><small class="roles"> Copyright holder, funder </small>  </li>
<li>Trevor Olsen <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=evalR" class="external-link"><img src="https://www.r-pkg.org/badges/version/evalR" alt="CRAN status"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Numerious Inc., Trevor Olsen.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
